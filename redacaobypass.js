javascript:(function(){const VERCEL_URL='https://redacao-ebon.vercel.app/api/transcribe';const origFetch=window.fetch;let realImageUrl=null;const grabPageImage=()=>{const imgs=document.querySelectorAll('img');for(const img of imgs){if(img.src&&img.src.includes('edusp-static.ip.tv')){realImageUrl=img.src;console.log('[Script] Imagem capturada da p√°gina:',realImageUrl);return;}}};grabPageImage();setTimeout(grabPageImage,2000);window.fetch=async function(...args){const[url,options]=args;if(typeof url==='string'&&url.includes('/ocr/manuscript')){return new Response(JSON.stringify({text:'Reda√ß√£o digitalizada pelo aluno.'}),{status:200,headers:{'Content-Type':'application/json'}});}if(typeof url==='string'&&url.includes('/tms/task')&&url.includes('/answer')&&!url.includes('/essay')&&!url.includes('/check')&&(options?.method==='POST'||options?.method==='PUT')){try{const b=JSON.parse(options.body);const answers=b.answers||{};const qId=Object.keys(answers)[0];if(qId&&answers[qId]?.answer){const ans=answers[qId].answer;if(!ans.essay_images||ans.essay_images.length===0){ans.essay_images=realImageUrl?[realImageUrl]:[];}console.log('[Script] essay_images injetado:',JSON.stringify(ans.essay_images));}return origFetch(url,{...options,body:JSON.stringify(b)});}catch(e){console.warn('[Script] Erro ao interceptar:',e);}}return origFetch(...args);};['copy','cut','paste'].forEach(e=>document.addEventListener(e,ev=>(ev.stopImmediatePropagation(),true),true));const enableFields=()=>{document.querySelectorAll('textarea').forEach(el=>{el.removeAttribute('disabled');el.classList.remove('Mui-disabled');el.closest?.('.MuiInputBase-root')?.classList.remove('Mui-disabled');});const s=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,'value').set;document.querySelectorAll('textarea').forEach(el=>{s.call(el,el.value);el.dispatchEvent(new Event('input',{bubbles:true}));});};enableFields();const fillField=(el,value)=>{const s=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,'value').set;s.call(el,value);el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));};const getTema=()=>{const ps=document.querySelectorAll('p,li');for(const p of ps){const txt=p.innerText||'';if(txt.includes('redija texto dissertativo')||(txt.includes('tema ')&&txt.length>80)){const strong=p.querySelector('strong');if(strong&&strong.innerText.trim().length>10)return strong.innerText.trim();}}return prompt('Qual √© o tema da reda√ß√£o?')||'Sustentabilidade e meio ambiente';};const getMinChars=()=>{const els=document.querySelectorAll('h6,p,span');for(const el of els){const txt=el.innerText||'';const m=txt.match(/N[¬∞¬∫]\s*m[√≠i]nimo de caracteres[:\s]+(\d+)/i);if(m)return parseInt(m[1]);}return 1000;};const getMaxChars=()=>{const els=document.querySelectorAll('h6,p,span');for(const el of els){const txt=el.innerText||'';const m=txt.match(/N[¬∞¬∫]\s*m[√°a]ximo de caracteres[:\s]+(\d+)/i);if(m)return parseInt(m[1]);}return null;};const btn=document.createElement('button');btn.textContent='ü§ñ Gerar Reda√ß√£o com IA';Object.assign(btn.style,{position:'fixed',bottom:'24px',right:'24px',zIndex:'999999',padding:'12px 20px',borderRadius:'999px',border:'none',background:'#6c3ee8',color:'#fff',fontWeight:'bold',fontSize:'14px',cursor:'pointer',boxShadow:'0 4px 16px rgba(0,0,0,0.3)',transition:'all .2s',opacity:'1',pointerEvents:'auto'});document.body.appendChild(btn);btn.addEventListener('click',async()=>{btn.textContent='‚è≥ Gerando...';btn.style.opacity='0.7';btn.style.pointerEvents='none';try{const tema=getTema();const res=await origFetch(VERCEL_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tema,minChars:getMinChars(),maxChars:getMaxChars()})});if(!res.ok)throw new Error(`Erro HTTP ${res.status}`);const data=await res.json();if(data.error)throw new Error(data.error);const textareas=[...document.querySelectorAll('textarea:not([aria-hidden="true"])')];if(data.body&&data.body.trim()){const bodyField=textareas.find(el=>el.value.includes('Reda√ß√£o digitalizada')||el.value.length>0&&el.id!==textareas[0]?.id)||textareas[1]||textareas[0];if(bodyField)fillField(bodyField,data.body);}if(data.title&&data.title.trim()){const titleField=textareas.find(el=>el.value===''||el.value.length<80)||textareas[0];if(titleField)fillField(titleField,data.title);}const max=getMaxChars();if(max&&data.body&&data.body.length>max){const bodyField2=textareas.find(el=>el.value===data.body)||textareas[1]||textareas[0];if(bodyField2)fillField(bodyField2,data.body.slice(0,max));}btn.textContent='‚úÖ Pronto!';btn.style.background='#16a34a';btn.style.opacity='1';}catch(err){btn.textContent='‚ùå '+err.message.slice(0,30);btn.style.background='#dc2626';btn.style.opacity='1';btn.style.pointerEvents='auto';console.error('[Gerador]',err);}});alert('‚úÖ Script ativado!\n\nClique no bot√£o roxo "Gerar Reda√ß√£o com IA" para come√ßar!');})();
